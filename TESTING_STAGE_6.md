# Тестирование: Этап 6 (Сессия тренировки и ввод сетов)

## Что реализовано в этапе 6

Цель этапа: рабочий цикл тренировки от создания сессии до завершения.

Реализовано:
- Экран создания сессии:
  - `app/(app)/workout/new/page.tsx`
  - `components/workout/session-create-form.tsx`
- Экран выполнения тренировки:
  - `app/(app)/workout/[sessionId]/page.tsx`
  - `components/workout/session-header.tsx`
  - `components/workout/session-sets-form.tsx`
- Server Actions:
  - `app/(app)/workout/actions.ts`
- DB-слой:
  - `lib/db/session-repository.ts`
  - `lib/db/session-queries.ts`
- Типы:
  - `types/session.ts`

## Подготовка к тестированию

1. Применены миграции этапов 2-4.
2. Есть импортированный активный план с днями и упражнениями.
3. Выполнен вход под тестовым пользователем.
4. Приложение запущено (`npm run dev`).

## Ручные тест-кейсы этапа 6

### TC-01: Создание новой сессии на валидную дату и день
Шаги:
1. Открыть `/workout/new`.
2. Выбрать день плана и дату.
3. Нажать `Создать сессию`.

Ожидаемый результат:
- Создаётся запись в `workout_sessions`.
- Происходит переход на `/workout/[sessionId]`.

### TC-02: Попытка создать дубликат сессии
Шаги:
1. Создать сессию на конкретную комбинацию `дата + день`.
2. Повторно создать сессию с той же комбинацией.

Ожидаемый результат:
- Новая запись не создаётся.
- Показана понятная ошибка о дубликате.
- Есть ссылка на уже существующую сессию.

### TC-03: Сохранение сетов с корректными значениями
Шаги:
1. На `/workout/[sessionId]` заполнить минимум один сет (set_number, reps, weight).
2. Нажать `Сохранить сеты`.

Ожидаемый результат:
- Сеты сохраняются в `session_sets`.
- Показано сообщение об успешном сохранении.

### TC-04: Ошибка валидации на отрицательных reps/weight
Шаги:
1. Ввести отрицательные значения в `reps` или `weight`.
2. Нажать `Сохранить сеты`.

Ожидаемый результат:
- Сохранение отклоняется.
- Отображается ошибка валидации строки.

### TC-05: Повторное сохранение обновляет, а не дублирует
Шаги:
1. Сохранить сет с ключом (`session_id`, `plan_exercise_id`, `set_number`).
2. Изменить `reps` или `weight` у того же ключа.
3. Снова сохранить.

Ожидаемый результат:
- Количество записей не увеличивается дубликатами.
- Значения в существующей записи обновлены.

### TC-06: Завершение сессии фиксирует completed_at
Шаги:
1. Иметь минимум один сохранённый сет.
2. Нажать `Завершить тренировку`.

Ожидаемый результат:
- `workout_sessions.status = completed`.
- `completed_at` заполнен актуальным timestamp.

### TC-07: Попытка изменить completed-сессию
Шаги:
1. Открыть завершённую сессию.
2. Попробовать изменить данные сетов.

Ожидаемый результат:
- Экран в read-only режиме.
- Запись/завершение повторно не выполняются.

### TC-08: Попытка открыть/изменить чужую сессию
Шаги:
1. Под пользователем A создать сессию.
2. Под пользователем B перейти на `/workout/[sessionId_A]`.
3. Попробовать сохранить сеты или завершить.

Ожидаемый результат:
- Доступ к чужой сессии отсутствует.
- Изменение чужой сессии невозможно (RLS + фильтрация по user_id).

## Что НЕ входит в этап 6

- Полноценный экран истории `/history` (этап 7).
- Продвинутая аналитика и метрики прогресса.
- Offline/фоновое автосохранение.
