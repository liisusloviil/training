# Тестирование: Этап 7 (История и просмотр прогресса)

## Что реализовано в этапе 7

Цель этапа: read-only история тренировок с фильтрацией, пагинацией и деталями сессии.

Реализовано:
- `/history`:
  - фильтры `from/to/status`
  - пагинация
  - список с базовыми агрегатами (сеты, упражнения, тоннаж)
- `/history/[sessionId]`:
  - read-only детали сессии
  - упражнения и все сохранённые сеты
- query-слой истории:
  - `lib/db/history-queries.ts`
- типы:
  - `types/history.ts`
- UI-компоненты:
  - `components/history/history-filters.tsx`
  - `components/history/history-list.tsx`
  - `components/history/session-details.tsx`

## Подготовка к тестированию

1. Применены миграции этапов 2-4.
2. Есть данные: минимум 2-3 сессии у пользователя (желательно с разными датами).
3. Для проверки доступа есть второй пользователь с отдельными сессиями.
4. Приложение запущено (`npm run dev`) и пользователь авторизован.

## Ручные тест-кейсы этапа 7

### TC-01: Список истории показывает только записи текущего пользователя
Шаги:
1. Войти под пользователем A.
2. Открыть `/history`.
3. Сверить, что видны только сессии A.

Ожидаемый результат:
- Чужие записи не отображаются.

### TC-02: Пустая история отображает empty-state
Шаги:
1. Войти под пользователем без сессий.
2. Открыть `/history`.

Ожидаемый результат:
- Показан empty-state с CTA на создание тренировки.

### TC-03: Фильтр from/to корректно отсекает сессии
Шаги:
1. На `/history` установить диапазон дат (`from` и/или `to`).
2. Нажать `Применить`.

Ожидаемый результат:
- Показаны только сессии, попадающие в диапазон `session_date`.
- Сброс фильтра возвращает полный список.

### TC-04: Фильтр status корректно работает
Шаги:
1. На `/history` выбрать по очереди:
- `completed`
- `in_progress`
- `all`
2. Нажать `Применить`.

Ожидаемый результат:
- Список соответствует выбранному статус-фильтру.

### TC-05: Пагинация стабильная и без дубликатов
Шаги:
1. Подготовить больше записей, чем размер страницы.
2. Перейти на следующую страницу и обратно.

Ожидаемый результат:
- Порядок стабильный (`session_date desc`, затем `created_at desc`).
- Одна и та же сессия не дублируется на соседних страницах.

### TC-06: Детали сессии содержат все сохранённые сеты
Шаги:
1. На `/history` открыть любую сессию через `Открыть детали`.
2. Сверить упражнения и сеты с данными в `session_sets`.

Ожидаемый результат:
- Все сохранённые сеты отображаются без потерь.
- Данные read-only.

### TC-07: Попытка открыть чужой sessionId
Шаги:
1. Под пользователем B открыть URL `/history/[sessionId_A]` (сессия пользователя A).

Ожидаемый результат:
- Доступ отклонён: сессия недоступна/не найдена.

### TC-08: Навигация из workout в детали history после завершения
Шаги:
1. Завершить сессию на `/workout/[sessionId]`.
2. Нажать ссылку `Открыть в истории`.

Ожидаемый результат:
- Открывается `/history/[sessionId]` с read-only деталями.

## Что НЕ входит в этап 7

- Продвинутая аналитика, графики и тренды.
- Экспорт истории в Excel/PDF.
- Сравнение нескольких сессий.
