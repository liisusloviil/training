# Тестирование: Этап 5 (Просмотр плана)

## Что реализовано в этапе 5

Цель этапа: показывать сохранённый активный план из Postgres на странице `/plan`.

Реализовано:
- Серверный query-слой чтения активного плана текущего пользователя:
  - `lib/db/plan-queries.ts`
- Полноценный экран `/plan`:
  - `app/(app)/plan/page.tsx`
- UI-компоненты плана:
  - `components/plan/plan-week.tsx`
  - `components/plan/plan-day.tsx`
  - `components/plan/plan-exercise.tsx`
  - `components/plan/plan-empty-state.tsx`
- CTA перехода на `/workout/new` как точка входа в этап 6.
- Ошибочное и пустое состояния страницы.

## Подготовка к тестированию

1. Применены миграции этапов 2-4.
2. Есть минимум один аккаунт с импортированным планом.
3. Для негативных кейсов желательно второй пустой аккаунт (без планов).
4. Запуск приложения:

```bash
npm run dev
```

## Ручные тест-кейсы (этап 5)

### TC-01: Активный план отображается на `/plan`
Шаги:
1. Под пользователем с импортированным планом открыть `/plan`.

Ожидаемый результат:
- Страница показывает структуру `неделя -> день -> упражнения`.
- Данные берутся из БД, а не из временного preview.

### TC-02: Порядок данных корректен
Шаги:
1. Подготовить план с 2+ неделями и несколькими днями/упражнениями.
2. Открыть `/plan`.

Ожидаемый результат:
- Недели отсортированы по `week_number`.
- Дни внутри недели отсортированы по `sort_order`.
- Упражнения внутри дня отсортированы по `sort_order`.

### TC-03: День без упражнений не ломает экран
Шаги:
1. Подготовить в БД день плана без упражнений (или импорт, где день остался пустым).
2. Открыть `/plan`.

Ожидаемый результат:
- Страница рендерится без падения.
- Для такого дня показывается безопасный текст о пустом списке.

### TC-04: Пустой аккаунт видит empty-state
Шаги:
1. Войти под пользователем без активного плана.
2. Открыть `/plan`.

Ожидаемый результат:
- Показывается empty-state.
- Есть CTA перехода на `/import`.

### TC-05: Роут `/plan` защищён авторизацией
Шаги:
1. Выйти из аккаунта.
2. Открыть `/plan` напрямую.

Ожидаемый результат:
- Редирект на `/login`.

### TC-06: После второго импорта виден новый активный план
Шаги:
1. Импортировать план A.
2. Импортировать план B.
3. Перейти на `/plan`.

Ожидаемый результат:
- Показывается план B.
- План A не отображается как активный.

### TC-07: CTA "Начать тренировку"
Шаги:
1. Открыть `/plan` с активным планом.
2. Нажать `Начать тренировку`.

Ожидаемый результат:
- Открывается `/workout/new` (точка входа к этапу 6).

## Что НЕ входит в этап 5 (ожидаемо)

- Реальное создание workout-session.
- Ввод сетов и сохранение результатов тренировки.
- Экран истории тренировок.
