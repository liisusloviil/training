# Тестирование: Этап 1 (Auth + каркас приложения)

## Что реализовано в этапе 1

Цель этапа: поднять базовый каркас приложения и авторизацию через Supabase.

Реализовано:
- Next.js App Router каркас проекта.
- Страница входа: `/login`.
- Защищённая зона приложения: группа маршрутов `(app)`.
- Глобальная проверка сессии через `proxy.ts`:
  - неавторизованный пользователь перенаправляется на `/login`;
  - авторизованный пользователь не может остаться на `/login` и уходит в приложение.
- Server Action для входа по `email/password`.
- Server Action для выхода (`logout`).
- Базовые защищённые страницы-заглушки:
  - `/import`
  - `/plan`

## Подготовка к тестированию

1. Убедиться, что заполнен `.env.local`:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
2. Убедиться, что в Supabase есть тестовый пользователь с валидными `email/password`.
3. Запустить проект:

```bash
npm install
npm run dev
```

## Ручные тест-кейсы (этап 1)

### TC-01: Редирект неавторизованного пользователя на `/login`
Шаги:
1. Открыть новую инкогнито-сессию браузера.
2. Перейти на `http://localhost:3000/import`.

Ожидаемый результат:
- Пользователь перенаправлен на `/login`.

### TC-02: Успешный вход с корректными данными
Шаги:
1. На странице `/login` ввести валидные `email/password`.
2. Нажать кнопку `Войти`.

Ожидаемый результат:
- Вход успешен.
- Открывается защищённая страница приложения (по умолчанию через `/` -> `/import`).
- В хедере отображается email пользователя.

### TC-03: Ошибка входа с неверными данными
Шаги:
1. На странице `/login` ввести неверный пароль.
2. Нажать `Войти`.

Ожидаемый результат:
- Пользователь остаётся на `/login`.
- Показано сообщение об ошибке входа.

### TC-04: Доступ к защищённым роутам после авторизации
Шаги:
1. Авторизоваться.
2. Перейти на `http://localhost:3000/import`.
3. Перейти на `http://localhost:3000/plan`.

Ожидаемый результат:
- Обе страницы открываются без редиректа на `/login`.

### TC-05: Авторизованный пользователь не должен видеть `/login`
Шаги:
1. Будучи авторизованным, перейти на `http://localhost:3000/login`.

Ожидаемый результат:
- Выполняется редирект в приложение (`/` с дальнейшим переходом на `/import`).

### TC-06: Выход из аккаунта
Шаги:
1. В защищённой зоне нажать кнопку `Выйти`.

Ожидаемый результат:
- Выполняется выход из сессии.
- Открывается `/login`.
- Повторный переход на защищённый роут (`/import`, `/plan`) снова ведёт на `/login`.

## Что НЕ входит в этап 1 (ожидаемо)

- Регистрация нового пользователя.
- OTP / magic link.
- Импорт Excel и сохранение плана в БД.
- Условный редирект `/` на `/plan`, если план уже существует.

Эти пункты покрываются следующими этапами по `MVP_PLAN.md`.
